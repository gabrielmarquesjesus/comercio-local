<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciativa Amigos do Bairro</title>
    <!-- Inclui a CDN do Tailwind CSS para estilização moderna e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
            color: #334155;
        }
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.15), 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="p-6">

    <!-- Cabeçalho -->
    <header class="bg-white rounded-xl shadow-lg p-8 mb-8 text-center">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-blue-900 tracking-tight">Catálogo de Comércios Locais</h1>
        <p class="mt-4 text-xl sm:text-2xl text-gray-600 font-light">Iniciativa Amigos do Bairro</p>
    </header>

    <!-- Container para os cartões de comércio -->
    <main id="catalog-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- O conteúdo será injetado aqui pelo JavaScript -->
    </main>

    <!-- Script para carregar e exibir os dados -->
    <script>
        // ID da planilha do Google Sheets
        const SPREADSHEET_ID = '1VZW6P34gL0Y8LSad5OeG1R2NDj6D_Iir1Nj-E7yf0DI';
        // URL da API de visualização do Google Sheets para obter dados em formato JSON
        const GOOGLE_SHEETS_URL = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json`;

        const container = document.getElementById('catalog-container');

        // Função assíncrona para buscar os dados
        const fetchSpreadsheetData = async () => {
            try {
                // Fetch dos dados da planilha
                const response = await fetch(GOOGLE_SHEETS_URL);
                const text = await response.text();

                // O texto da resposta vem com um prefixo, então precisamos limpá-lo
                const jsonText = text.substring(text.indexOf('(') + 1, text.lastIndexOf(')'));
                const data = JSON.parse(jsonText);

                const rows = data.table.rows;

                if (rows.length === 0) {
                    container.innerHTML = '<p class="text-center text-gray-500 text-lg">Nenhum dado encontrado na planilha.</p>';
                    return;
                }

                // Itera sobre cada linha de dados (cada comércio)
                rows.forEach(row => {
                    const columns = row.c;

                    // Extrai as informações de cada coluna usando os índices corrigidos
                    // Extrai as informações de cada coluna usando os índices corrigidos
const nome = columns[1] && columns[1].v ? columns[1].v : 'Nome não disponível';
const servico = columns[2] && columns[2].v ? columns[2].v : 'Serviço não disponível';
const endereco = columns[3] && columns[3].v ? columns[3].v : 'Endereço não disponível';
const contato = columns[4] && columns[4].v ? columns[4].v : 'Contato não disponível';
const horario = columns[5] && columns[5].v ? columns[5].v : 'Não informado';
const divulgacao = columns[6] && columns[6].v ? columns[6].v : '';
const imageURL = columns[7] && columns[7].v ? columns[7].v : '';

                    
                    // Extrai o ID do arquivo do Google Drive e constrói um link de acesso direto
                    if (imageURL.includes('drive.google.com')) {
                        const idMatch = imageURL.match(/(?:id=|\/d\/)([a-zA-Z0-9_-]+)/);
                        if (idMatch && idMatch[1]) {
                            imageURL = `https://drive.google.com/uc?export=view&id=${idMatch[1]}`;
                        }
                    }

                    // Limita o texto de divulgação a 250 caracteres e adiciona reticências se necessário
                    if (divulgacao.length > 250) {
                        divulgacao = divulgacao.substring(0, 250) + '...';
                    }

                    // Cria um novo elemento de cartão para o comércio
                    const card = document.createElement('div');
                    card.className = 'card bg-white p-6 rounded-xl border border-gray-200';

                    // Constrói o HTML interno do cartão, com labels em negrito e tratamento de erro para a imagem
                    let cardContent = `
                        ${imageURL ? `<img src="${imageURL}" alt="Imagem de divulgação" class="w-full aspect-square object-cover rounded-lg mb-4" onerror="this.src='https://placehold.co/192x192/E2E8F0/94A3B8?text=Imagem+indisponível'; console.error('A imagem do Google Drive não pode ser carregada. Verifique as permissões de compartilhamento do arquivo.');">` : ''}
                        <h2 class="text-2xl font-semibold text-blue-800 mb-2">${nome}</h2>
                        <p class="text-gray-600 mb-1"><span class="font-bold text-gray-700">Prestação de Serviço:</span> ${servico}</p>
                        <p class="text-gray-600 mb-1"><span class="font-bold text-gray-700">Endereço:</span> ${endereco}</p>
                        <p class="text-gray-600 mb-1"><span class="font-bold text-gray-700">Contato:</span> ${contato}</p>
                        <p class="text-gray-600 mb-4"><span class="font-bold text-gray-700">Horário de funcionamento:</span> ${horario}</p>
                    `;

                    // Adiciona o texto de divulgação se existir
                    if (divulgacao.trim() !== '') {
                        cardContent += `
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <p class="text-gray-600 italic">${divulgacao}</p>
                            </div>
                        `;
                    }
                    card.innerHTML = cardContent;

                    // Adiciona o cartão ao container principal
                    container.appendChild(card);
                });

            } catch (error) {
                console.error('Erro ao buscar ou processar os dados da planilha:', error);
                container.innerHTML = '<p class="text-center text-red-500 text-lg">Erro ao carregar o catálogo. Tente novamente mais tarde.</p>';
            }
        };

        // Chama a função para buscar os dados quando a página carregar
        document.addEventListener('DOMContentLoaded', fetchSpreadsheetData);
    </script>

</body>
</html>
